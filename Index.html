<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مرکز یادگیری واژگان فارسی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }
        /* Styles for Quiz */
        .answer-btn.selected {
            background-color: #93c5fd; /* Tailwind blue-300 */
            border-color: #3b82f6; /* Tailwind blue-500 */
        }
        .review-item.correct {
            background-color: #f0fdf4; /* Tailwind green-50 */
            border-right-color: #22c55e; /* Tailwind green-500 */
        }
        .review-item.incorrect {
            background-color: #fef2f2; /* Tailwind red-50 */
            border-right-color: #ef4444; /* Tailwind red-500 */
        }
    </style>
</head>
<body class="bg-slate-100">

    <div class="container mx-auto p-4 md:p-8">
        <!-- Main Hub View -->
        <div id="hub-container">
            <header class="bg-white rounded-xl shadow-md p-6 mb-8">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold text-slate-800">مرکز یادگیری واژگان فارسی</h1>
                        <p class="text-slate-500 mt-1">راهنمای کامل شما برای واژگان ادبیات داستانی</p>
                    </div>
                    <button id="go-to-quiz-btn" class="mt-4 md:mt-0 bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors shadow-sm">
                        دانش خود را بسنجید 🧠
                    </button>
                </div>
                <div class="mt-6 flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <label for="search-input" class="sr-only">جستجوی واژه</label>
                        <input type="text" id="search-input" placeholder="جستجو برای یک واژه..." class="w-full border-2 border-slate-200 rounded-lg p-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div class="flex-1">
                        <label for="source-select" class="sr-only">انتخاب داستان</label>
                        <select id="source-select" class="w-full border-2 border-slate-200 rounded-lg p-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                            <option value="all">همه‌ی داستان‌ها</option>
                            <!-- Options will be generated by JS -->
                        </select>
                    </div>
                </div>
            </header>

            <main id="word-container" class="card-grid">
                <!-- Word cards will be generated here -->
            </main>
        </div>

        <!-- Quiz View -->
        <div id="quiz-view-container" class="hidden">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-auto text-center overflow-hidden">
                <div class="bg-blue-600 text-white p-6">
                    <h1 class="text-2xl font-bold">آزمون واژگان</h1>
                </div>
                <div class="p-8">
                    <!-- Source Selection Screen -->
                    <div id="source-selection-container">
                        <h2 class="text-xl font-semibold mb-4 text-slate-700">۱. یک داستان را برای آزمون انتخاب کنید:</h2>
                        <div id="source-buttons" class="flex flex-wrap justify-center gap-3">
                            <!-- Source selection buttons will be generated here by JS -->
                        </div>
                        <button id="back-to-hub-btn" class="mt-8 text-sm text-slate-500 hover:text-blue-600">→ بازگشت به مرکز مطالعه</button>
                    </div>

                    <!-- Mode Selection Screen -->
                    <div id="mode-selection-container" class="hidden">
                        <h2 class="text-xl font-semibold mb-4 text-slate-700">۲. یک حالت را انتخاب کنید:</h2>
                        <div class="flex justify-center gap-4">
                            <button id="normal-mode-btn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-600 transition-colors">حالت عادی</button>
                            <button id="hard-mode-btn" class="bg-red-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-600 transition-colors">حالت سخت</button>
                        </div>
                        <button id="back-to-sources-btn" class="mt-6 text-sm text-slate-500 hover:text-blue-600">→ بازگشت به انتخاب داستان</button>
                    </div>

                    <!-- Normal Mode Quiz Container -->
                    <div id="quiz-container" class="hidden">
                        <h2 id="question-text" class="text-2xl font-semibold text-slate-800 mb-3"></h2>
                        <p id="hint-text" class="text-slate-600 italic mb-6"></p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4" id="answer-buttons"></div>
                        <div class="flex justify-between items-center mt-6">
                            <button id="back-to-menu-btn-normal" class="text-slate-600 font-medium hover:text-blue-600 transition-colors">→ بازگشت به منو</button>
                            <div class="flex items-center gap-3">
                                <button id="next-btn-normal" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors">بعدی</button>
                                <span id="question-counter-normal" class="text-slate-600 font-medium w-24 text-center"></span>
                                <button id="prev-btn-normal" class="bg-slate-200 text-slate-700 font-bold py-2 px-6 rounded-lg hover:bg-slate-300 transition-colors">قبلی</button>
                            </div>
                        </div>
                    </div>

                    <!-- Hard Mode Quiz Container -->
                    <div id="hard-mode-container" class="hidden">
                        <h2 id="hard-mode-question-text" class="text-2xl font-semibold text-slate-800 mb-4"></h2>
                        <input type="text" id="hard-mode-input" class="w-full border-2 border-slate-300 rounded-lg p-3 text-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="معنی را تایپ کنید...">
                        <div class="flex justify-between items-center mt-6">
                            <button id="back-to-menu-btn-hard" class="text-slate-600 font-medium hover:text-blue-600 transition-colors">→ بازگشت به منو</button>
                            <div class="flex items-center gap-3">
                                <button id="next-btn-hard" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors">بعدی</button>
                                <span id="hard-mode-question-counter" class="text-slate-600 font-medium w-24 text-center"></span>
                                <button id="prev-btn-hard" class="bg-slate-200 text-slate-700 font-bold py-2 px-6 rounded-lg hover:bg-slate-300 transition-colors">قبلی</button>
                            </div>
                        </div>
                    </div>

                    <!-- Results Screen -->
                    <div id="results-container" class="hidden">
                        <h2 class="text-3xl font-bold text-slate-800 mb-2">نتایج آزمون</h2>
                        <p id="score-text" class="text-lg text-slate-600 mb-6"></p>
                        <div id="results-review" class="space-y-4 text-right max-h-96 overflow-y-auto p-4 bg-slate-50 rounded-lg">
                            <!-- Results review will be generated here -->
                        </div>
                        <button id="restart-btn" class="mt-6 bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors">انتخاب یک داستان دیگر</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    const vocabularyData = {
        'سمک عیار': [
            { word: "بندیان", definition: "زندانیان، اسیران", example: "چون سمک از پیش خورشید شاه به شهر باز آمد از بهر طلب کردن بندیان...", tldr: "اسیران", tip: "فکر کنید به کسانی که در 'بند' هستند.", brainrot: "کل اسکوادشون بندیان ما شدن.", distractors: ["بی‌شرمان", "سلاح‌ها", "دردسرها"] },
            { word: "گوش داشتن", definition: "مواظب و مراقب بودن، توجه دقیق کردن", example: "شما این جایگاه باشید؛ گوش با من دارید.", tldr: "مراقبت", tip: "یعنی تمام توجه و حواست به چیزی باشد.", brainrot: "گوش با منه، دارم یه پلن خفن می‌ریزم.", distractors: ["بی‌شرم بودن", "اسلحه داشتن", "دردسر داشتن"] },
            { word: "ناداشت", definition: "بی‌شرم، بی‌اعتقاد", example: "زن گفت: ای آزاد مرد تو غریبی و نمی‌دانی سرخ کافر مردی ناداشت است.", tldr: "بی‌حیا", tip: "کسی که چیزی برایش مهم نیست و حد و مرز 'ندارد'.", brainrot: "عجب آدم ناداشتیه، کل لوت رو برداشت.", distractors: ["مراقب", "سلاح", "دردسر"] },
            { word: "سلیح", definition: "املای دیگر سلاح، اسلحه", example: "سمک عیار گفت: ای مادر این سلیح من به امانت به خانه‌ی تو بنه...", tldr: "اسلحه", tip: "فقط یک جور دیگر نوشتن 'سلاح' است.", brainrot: "سلیح لجندری دستشه، مراقب باش.", distractors: ["زندانیان", "بی‌شرمان", "دردسر"] },
            { word: "صداع", definition: "دردسر", example: "سمک عیار گفت سلاح بنهم و صداع ببرم.", tldr: "دردسر", tip: "مثل 'سردرد' که یک نوع دردسر است.", brainrot: "این کوئست جدید عجب صداعی شده.", distractors: ["اسیران", "مراقبت", "اسلحه"] },
            { word: "کانون", definition: "خانه", example: "آن روز کانون باز سوی آن خانه آمده بود...", tldr: "خانه", tip: "کانون خانواده یعنی مرکز و خانه خانواده.", brainrot: "بریم کانون خودمون لوت کنیم.", distractors: ["اندازه", "دهان", "خشمگین"] },
            { word: "چند", definition: "اندازه", example: "چند مناره‌ای به دکانی نشسته...", tldr: "اندازه", tip: "در اینجا به معنی 'به اندازه' یا 'هم قد و قواره' است.", brainrot: "یه اسکواد چند یه لشکر ریختن سرمون.", distractors: ["خانه", "دهان", "خشمگین"] },
            { word: "وی", definition: "دهان او را", example: "سمک در وی جست و سبک دست و پای وی به کمند دربست و دهان وی بیاگند...", tldr: "دهانش", tip: "در این متن خاص به معنی دهان است.", brainrot: "تا اومد حرف بزنه وی رو بست.", distractors: ["خانه", "اندازه", "عصبانی"] },
            { word: "بیاگند", definition: "پر کرد، بست", example: "دهان وی به کمند دربست و دهان وی بیاگند...", tldr: "پر کرد", tip: "از مصدر 'آکندن' به معنی پر کردن.", brainrot: "چت رو با اسپم بیاگند.", distractors: ["عصبانی شد", "اندازه", "خانه"] },
            { word: "از جای برآمد", definition: "خشمگین و عصبانی شد", example: "زن چون نام سرخ کافر بشنید از جای برآمد...", tldr: "عصبانی شد", tip: "وقتی کسی از عصبانیت از جایش بلند می‌شود.", brainrot: "وقتی کیلشو دزدیدن از جای برآمد.", distractors: ["پر کرد", "اندازه", "خانه"] }
        ],
        'سه بازرگان': [
            { word: "اعوام", definition: "سال‌ها", example: "چنین آورده‌اند که در اعوام ماضیه سه کس از دهات عالم بر سبیل مشارکت تجارت می‌کردند.", tldr: "سال‌ها", tip: "جمع 'عام' به معنی سال است.", brainrot: "اعوام زیادی طول کشید تا این بازی رو پلات کنم.", distractors: ["گذشته", "زیرکان", "خرده عدد"] },
            { word: "ماضیه", definition: "گذشته", example: "چنین آورده‌اند که در اعوام ماضیه...", tldr: "گذشته", tip: "مثل 'زمان ماضی' در دستور زبان.", brainrot: "این استراتژی مال اعوام ماضیه است، دیگه جواب نمیده.", distractors: ["سال‌ها", "زیرکان", "خرده عدد"] },
            { word: "دهات", definition: "جمع داهی، زیرکان", example: "...سه کس از دهات عالم بر سبیل مشارکت تجارت می‌کردند.", tldr: "زیرکان", tip: "با 'دهات' به معنی روستاها اشتباه نگیرید. اینجا جمع 'داهی' است.", brainrot: "این تیم از دهات گیمرها تشکیل شده.", distractors: ["سال‌ها", "گذشته", "خرده عدد"] },
            { word: "کسور", definition: "خرده عدد، غیر کامل", example: "قسمت کردن هزار دینار دشوار بود و از کسور و قصور خالی نباشد.", tldr: "کسر", tip: "مثل 'اعداد کسری' در ریاضی.", brainrot: "اینقدر دمیجش دادم که جونش کسور داشت.", distractors: ["آدم قابل اعتماد", "ذخیره", "راستی و درستی"] },
            { word: "معتمد", definition: "آدم قابل اعتماد", example: "این کیسه نزدیک معتمدی به امانت نهیم...", tldr: "قابل‌اعتماد", tip: "کسی که به او 'اعتماد' می‌کنی.", brainrot: "اون یار معتمد تیمه، همیشه بک می‌ده.", distractors: ["ذخیره", "راستی و درستی", "سفارش"] },
            { word: "مدخره", definition: "ذخیره", example: "...و در باقی عمر ما را مدخره گردد.", tldr: "ذخیره", tip: "از ریشه 'ذخر' که در عربی هم به معنی ذخیره است.", brainrot: "این شیلد پات‌ها رو برای آخر بازی مدخره نگه دار.", distractors: ["آدم قابل اعتماد", "راستی و درستی", "سفارش"] },
            { word: "سداد", definition: "راستی و درستی", example: "...به خانه‌ی پیرزنی رفتند که به امانت و سداد موصوف بود...", tldr: "درستی", tip: "کلمه‌ای که حس استحکام و درستی می‌دهد.", brainrot: "تو بازی باید سداد داشته باشی و تقلب نکنی.", distractors: ["ذخیره", "سفارش", "پیر سالخورده"] },
            { word: "وصایت", definition: "سفارش", example: "...و وصایت می‌کنیم تا هر سه جمع نشویم این کیسه به کسی ندهی.", tldr: "سفارش", tip: "مثل 'وصیت' کردن.", brainrot: "بهش وصایت کردم که حواسش به پشت سرمون باشه.", distractors: ["ذخیره", "درستی", "پیر سالخورده"] },
            { word: "گنده پیر", definition: "پیر سالخورده (به ویژه زن)", example: "...و از گنده پیر گل و شانه خواهیم...", tldr: "پیرزن", tip: "ترکیب 'گنده' (بزرگ) و 'پیر'.", brainrot: "این اسکین جدیده شبیه گنده پیر شده.", distractors: ["تاوان", "اصرار", "چاره کردن"] },
            { word: "غرامت", definition: "تاوان، جریمه", example: "چرا دادی؟ غرامت بر تو لازم است.", tldr: "جریمه", tip: "وقتی کاری می‌کنی که خسارت دارد، باید غرامت بدهی.", brainrot: "باید غرامت بدی چون باعث شدی ببازیم.", distractors: ["اصرار", "چاره کردن", "بی‌درنگ"] },
            { word: "الحاح", definition: "اصرار، پافشاری", example: "کودک الحاح در میان آورد و سوگندان غلاظ و شداد بر وی داد.", tldr: "اصرار", tip: "وقتی خیلی روی چیزی پافشاری می‌کنی.", brainrot: "اینقدر الحاح کرد تا بالاخره ری‌وایوش کردم.", distractors: ["تاوان", "چاره کردن", "بی‌درنگ"] },
            { word: "تدارک", definition: "چاره کردن", example: "کودک گفت تدارک این مشکل آسان است...", tldr: "چاره", tip: "مثل 'تدارکات' که برای آماده‌سازی و چاره‌اندیشی است.", brainrot: "باید یه تدارکی برای این کمپرها ببینیم.", distractors: ["تاوان", "اصرار", "بی‌درنگ"] },
            { word: "بر بدیهه", definition: "بی‌درنگ", example: "پیرزن این حجت‌ها یاد کرد و بر بدیهه پیش حاکم رفت...", tldr: "فورا", tip: "مثل 'بداهه' گفتن که بدون فکر قبلی و فوری است.", brainrot: "بر بدیهه راش داد و کل اسکواد رو زد.", distractors: ["ناامید", "چاره کردن", "اصرار"] },
            { word: "خایب و خاسر", definition: "ناامید و زیان دیده", example: "خصمان خایب و خاسر برفتند...", tldr: "شکست‌خورده", tip: "دو کلمه با معنی نزدیک برای تاکید بر شکست.", brainrot: "تیم حریف خایب و خاسر به لابی برگشت.", distractors: ["بی‌درنگ", "اصرار", "چاره کردن"] }
        ],
        'هزار و یک شب': [
            { word: "مسخ", definition: "تغییر دادن صورت کسی به شکلی بدتر", example: "او به من نفرین کرد خدای تعالی مرا به صورت خر مسخ کرد.", tldr: "تغییر-شکل", tip: "وقتی کسی یا چیزی به موجودی دیگر و معمولا زشت‌تر تبدیل می‌شود.", brainrot: "این گلیچ جدیده کاراکتر رو مسخ می‌کنه.", distractors: ["حلال کردن", "صدقه دادن", "نامبارک"] },
            { word: "بحل کردن", definition: "حلال کردن، بخشیدن", example: "تو را به خدا سوگند می‌دهم که اگر بدی به تو کرده‌ام مرا بحل کن.", tldr: "بخشیدن", tip: "از ریشه 'حلال' می‌آید.", brainrot: "باید منو بحل کنی که لوتت رو برداشتم.", distractors: ["تغییر شکل", "صدقه دادن", "نامبارک"] },
            { word: "تصدق دادن", definition: "دادن چیزی به نیازمندان", example: "پس آن زن تصدق بداد و استغفار گفت...", tldr: "صدقه-دادن", tip: "همان 'صدقه' دادن است.", brainrot: "یه شیلد پات بهش تصدق دادم.", distractors: ["تغییر شکل", "حلال کردن", "نحس"] },
            { word: "شوم", definition: "نامبارک، نحس", example: "ای شوم پندارم که باز شراب خورده مادر خود را آزرده و او تو را نفرین کرده.", tldr: "نحس", tip: "وقتی چیزی بدیمن و بدشگون باشد.", brainrot: "این لندینگ شوم همیشه اول بازی حذف میشیم.", distractors: ["تغییر شکل", "بخشیدن", "صدقه دادن"] }
        ],
        'تذکرة الاولیا': [
            { word: "دبیرستان", definition: "محل تعلیم", example: "نقل است که چون بایزید بسطامی را مادرش به دبیرستان فرستاد...", tldr: "مدرسه", tip: "در گذشته به مکتب و محل آموزش 'دبیرستان' می‌گفتند.", brainrot: "این بازی خودش یه دبیرستان برای یادگیری استراتژیه.", distractors: ["اجازه دادن", "پیشکاری", "تحمل رنج"] },
            { word: "دستوری دادن", definition: "اجازه دادن", example: "استاد دستوری داد بایزید به خانه آمد...", tldr: "اجازه", tip: "همان 'دستور' دادن است اما به معنی اجازه.", brainrot: "بهم دستوری داد که راش بدم.", distractors: ["محل تعلیم", "پیشکاری", "تحمل رنج"] },
            { word: "کدخدایی", definition: "پیشکاری", example: "من در دو خانه کدخدایی نتوانم کرد...", tldr: "ریاست", tip: "کدخدا رئیس و بزرگ یک روستا یا خانه بود.", brainrot: "تو این اسکواد کی کدخدایی می‌کنه؟", distractors: ["محل تعلیم", "اجازه دادن", "یخ زدن"] },
            { word: "ریاضت", definition: "تحمل رنج برای تهذیب نفس", example: "آن چه در جمله‌ی ریاضت و مجاهده می‌جستم در آن یافتم...", tldr: "سختی‌کشیدن", tip: "مثل ورزشکارانی که برای آمادگی ریاضت می‌کشند.", brainrot: "این رنک آپ کردن خودش یه ریاضته.", distractors: ["یخ زده بود", "اجازه دادن", "پیشکاری"] },
            { word: "فسرده بود", definition: "یخ زده بود", example: "دید کوزه در دست من فسرده بود.", tldr: "یخ‌زده", tip: "با 'افسرده' به معنی غمگین فرق دارد.", brainrot: "از ترس تو جام فسرده بودم.", distractors: ["تحمل رنج", "پیشکاری", "محل تعلیم"] }
        ],
        'کلیله و دمنه': [
            { word: "کبک نخجیر", definition: "دراج، کبک سیاه رنگ", example: "زاغی با کبک نخجیری در کوهساری به مجاورت یکدیگر বাসা داشتند.", tldr: "کبک-سیاه", tip: "نخجیر به معنی شکار است، پس کبکی که شکار می‌شود.", brainrot: "این پلیر مثل کبک نخجیر کمیابه.", distractors: ["همسایگی", "داور", "خوار شده"] },
            { word: "مجاورت", definition: "همسایگی", example: "به مجاورت یکدیگر বাসা داشتند.", tldr: "همسایگی", tip: "از ریشه 'جوار' به معنی کنار و همسایگی.", brainrot: "در مجاورت ما یه اسکواد دیگه هم هست.", distractors: ["کبک سیاه", "داور", "خوار شده"] },
            { word: "حکم", definition: "داور", example: "گربه را حکم گزیدند.", tldr: "داور", tip: "کسی که 'حکم' می‌کند.", brainrot: "باید یه حکم بیاریم ببینیم حق با کیه.", distractors: ["همسایگی", "روش", "خو گرفتن"] },
            { word: "متعبد", definition: "بسیار عبادت کننده", example: "گربه متعبد بود.", tldr: "عابد", tip: "کسی که زیاد 'عبادت' می‌کند.", brainrot: "اینقدر بازی می‌کنه انگار متعبده.", distractors: ["همیشه روزه‌دار", "خوار شده", "حیله"] },
            { word: "صائم الدهر", definition: "کسی که همیشه روزه دار است", example: "گربه صائم الدهر بود.", tldr: "همیشه‌روزه", tip: "'صائم' یعنی روزه‌دار و 'دهر' یعنی روزگار.", brainrot: "اینقدر نوب بود انگار صائم الدهر بود و انرژی نداشت.", distractors: ["بسیار عبادت کننده", "خوار شده", "حیله"] },
            { word: "مخذول", definition: "خوار داشته شده، بدبخت", example: "مخذول و محروم بازگردد.", tldr: "خوار", tip: "از ریشه خذلان به معنی خواری.", brainrot: "بعد از اون شکست مخذول شد.", distractors: ["همیشه روزه‌دار", "روش", "خو گرفتن"] },
            { word: "نمط", definition: "روش", example: "بر این نمط می‌گفت.", tldr: "روش", tip: "مثل 'به این منوال'.", brainrot: "باید نمط بازیمون رو عوض کنیم.", distractors: ["همیشه روزه‌دار", "خوار شده", "حیله"] },
            { word: "دمدمه و افسون", definition: "حیله و تزویر", example: "دمدمه و افسون او در دل کارگر آمد.", tldr: "حیله", tip: "دو کلمه برای تاکید بر فریبکاری.", brainrot: "با دمدمه و افسون منو گول زد و لوت منو برداشت.", distractors: ["روش", "خوار شده", "خو گرفتن"] },
            { word: "الف گرفتن", definition: "خو گرفتن، دوست شدن", example: "با او الف گرفتند.", tldr: "خو-گرفتن", tip: "مثل حروف 'الفبا' که با هم دوست هستند.", brainrot: "سریع با تیم جدیدش الف گرفت.", distractors: ["روش", "حیله", "خوار شده"] }
        ],
        'مرزبان نامه': [
            { word: "رزمه ی جامه", definition: "بقچه ی رخت، بسته ی لباس", example: "وقتی مردی جامه فروش رزمه ی جامه دربست...", tldr: "بقچه-لباس", tip: "بسته‌ای که در آن لباس می‌پیچیدند.", brainrot: "باید این همه لوت رو تو یه رزمه جامه جا بدم.", distractors: ["کوله پشتی", "اسب بارکش", "زودباش"] },
            { word: "پشتواره", definition: "کوله پشتی", example: "مرد از کشیدن پشتواره به ستوه آمد...", tldr: "کوله‌پشتی", tip: "باری که بر 'پشت' حمل می‌شود.", brainrot: "پشتواره‌م پره، دیگه جا ندارم.", distractors: ["بقچه لباس", "اسب بارکش", "زودباش"] },
            { word: "بارگیر", definition: "اسب بارکش", example: "...اما این بارگیر من دوش را تب هر روزه جو نیافته است.", tldr: "اسب-بارکش", tip: "حیوانی که 'بار' را 'می‌گیرد' و حمل می‌کند.", brainrot: "این ماشین تو بازی حکم بارگیر رو داره.", distractors: ["کوله پشتی", "بقچه لباس", "زودباش"] },
            { word: "هلا", definition: "یا الله، زودباش", example: "سوار به نزدیک او باز آمد و گفت: هلا به من ده تا لحظه‌ای بیاسایی.", tldr: "زودباش", tip: "یک کلمه برای صدا زدن و ترغیب کردن.", brainrot: "هلا! پوش بده!", distractors: ["کوله پشتی", "اسب بارکش", "بقچه لباس"] }
        ],
        'اسرار التوحید': [
            { word: "قه", definition: "مخفف «قدس الله سره»", example: "وقتی شیخ ابوسعید «قه» در میهنه مجلس میگفت...", tldr: "قدس‌الله‌سره", tip: "یک دعای احترام‌آمیز برای عارفان درگذشته.", brainrot: "این پلیر «قه» یه لجند بود.", distractors: ["وعظ گفتن", "کفش به پا کردن", "طریقه عارفان"] },
            { word: "مجلس گفتن", definition: "وعظ گفتن، سخنرانی کردن", example: "آن روز شیخ مجلس تمام کرد.", tldr: "سخنرانی", tip: "وقتی کسی برای جمعی صحبت و موعظه می‌کند.", brainrot: "اینقدر حرف زد انگار داشت مجلس می‌گفت.", distractors: ["کفش به پا کردن", "طریقه عارفان", "قدس‌الله‌سره"] },
            { word: "پای افزار کردن", definition: "کفش به پا کردن با قصد راهی شدن", example: "آن درویش پای افزار کرد و به جانب ماوراء النهر برفت.", tldr: "آماده-رفتن", tip: "'افزار' به معنی ابزار است، پس ابزار پا یعنی کفش.", brainrot: "یالا پای افزار کن باید بریم تو زون.", distractors: ["وعظ گفتن", "طریقه عارفان", "قدس‌الله‌سره"] },
            { word: "از این شیوه", definition: "از شیوه و طریقه عارفان و صوفیان", example: "و هر کسی از این شیوه سخنی گفتندی...", tldr: "از-عارفان", tip: "در اینجا 'شیوه' به یک مکتب و روش خاص عرفانی اشاره دارد.", brainrot: "این نوع پلی دادن از این شیوه‌ست که فقط پروها بلدن.", distractors: ["وعظ گفتن", "کفش به پا کردن", "قدس‌الله‌سره"] }
        ],
        'بایزید و قلاش': [
            { word: "صرافان", definition: "بازار ارز", example: "به کاری بایزید عالم افروز / به صرافان گذر می‌کرد یک روز", tldr: "صرافی‌ها", tip: "جایی که پول را 'صرف' می‌کنند یا چنج می‌کنند.", brainrot: "اینجا مثل بازار صرافانه، همه دنبال آیتم‌های باارزشن.", distractors: ["می‌خوار", "تنبیه شرعی", "وارونه"] },
            { word: "قلاش", definition: "می خوار، حقه باز، لوند", example: "یکی قلاش را در پیش ره دید / از سر تا پای او غرق گنه دید", tldr: "حقه‌باز", tip: "آدم بی‌قید و بند و کلک.", brainrot: "عجب قلاشی بود، کل لوت رو دزدید و رفت.", distractors: ["بازار ارز", "تنبیه شرعی", "وارونه"] },
            { word: "حد", definition: "تنبیه شرعی", example: "چنان میزد کسی حدش به غایت / که خون می‌ریخت بی حد و نهایت", tldr: "شلاق", tip: "مجازاتی که در شرع مشخص شده.", brainrot: "اگه تقلب کنی ادمین حدت می‌زنه.", distractors: ["بازار ارز", "می‌خوار", "وارونه"] },
            { word: "بازگونه", definition: "وارونه، برعکس", example: "همه کار تو در دین بازگونه است / ببین تا خود تو چونی او چگونه است", tldr: "برعکس", tip: "همان 'واژگونه' است.", brainrot: "همه چی بازگونه شد، برنامه‌مون خراب شد.", distractors: ["بازار ارز", "می‌خوار", "تنبیه شرعی"] }
        ],
        'عین القضات': [
            { word: "سلف صالح", definition: "پدران پاک و نیکوکار", example: "در سلف صالح در اخلاق و اوصاف مرد نگاه کردندی.", tldr: "نیاکان-نیک", tip: "'سلف' یعنی گذشتگان و 'صالح' یعنی نیکوکار.", brainrot: "باید مثل سلف صالح این بازی، با احترام پلی بدیم.", distractors: ["یاوه‌گویی", "حقوق", "فخر کردن"] },
            { word: "ادرار", definition: "حقوق، مستمری", example: "اکنون از بهر صد دینار ادرار و پنجاه دینار حرام شب و روز با پادشاهان فاسق نشینند.", tldr: "حقوق", tip: "در اینجا معنی متفاوتی با کاربرد امروزی دارد.", brainrot: "ادرار ما از این بازی فقط استرسه.", distractors: ["یاوه‌گویی", "فخر کردن", "بخشش زمین"] },
            { word: "تبجح", definition: "شادمانی، فخر کردن", example: "...آن را تبجح بازگویند و شرم ندارند...", tldr: "فخرفروشی", tip: "وقتی کسی با شادی و غرور از کاری تعریف می‌کند.", brainrot: "بعد از یه کیل شانسی کلی تبجح کرد.", distractors: ["یاوه‌گویی", "حقوق", "بخشش زمین"] },
            { word: "اقطاع", definition: "بخشیدن ملک یا قطعه زمین به کسی", example: "پندارند که بهشت به اقطاع به ایشان داده‌اند.", tldr: "بخشش-زمین", tip: "وقتی حاکم قطعه‌ای زمین را به کسی می‌بخشید.", brainrot: "کل این منطقه رو انگار به این اسکواد اقطاع کردن.", distractors: ["یاوه‌گویی", "حقوق", "فخر کردن"] }
        ],
        'کشف الاسرار': [
            { word: "کاسد", definition: "خریداری نداشت، فروش نمی‌رفت", example: "مردی را دید که ماهی میفروخت و ماهی وی کاسد بود.", tldr: "بی‌رونق", tip: "مثل 'بازار کاسد' که یعنی بازاری که خرید و فروش در آن کم است.", brainrot: "این سیزن بازار این اسکین کاسده.", distractors: ["بازار جواهر", "گدا", "شادی و سختی"] },
            { word: "جوهریان", definition: "بازار جواهر فروشان", example: "به جوهریان برد به صد هزار درم آن را برگرفتند.", tldr: "جواهر-فروشان", tip: "کسانی که با 'جوهر' یا همان جواهر سر و کار دارند.", brainrot: "این آیتم‌ها پیش جوهریان بازی خیلی ارزش داره.", distractors: ["بی‌رونق", "گدا", "شادی و سختی"] },
            { word: "سائلی", definition: "فقیری، گدایی", example: "سائلی بر در سرای ایشان بایستاد.", tldr: "گدا", tip: "کسی که 'سؤال' می‌کند یا درخواست کمک دارد.", brainrot: "مثل سائلی‌ها دنبال یه ذره لوت می‌گشتم.", distractors: ["بی‌رونق", "بازار جواهر", "شادی و سختی"] },
            { word: "سرا و ضرا", definition: "شادمانی و سختی", example: "الله شما را آزمایش کرد در سرا و ضرا.", tldr: "خوشی-ناخوشی", tip: "دو کلمه متضاد برای نشان دادن همه شرایط زندگی.", brainrot: "تو سرا و ضرا باید هوای هم‌تیمی‌تو داشته باشی.", distractors: ["بی‌رونق", "گدا", "بازار جواهر"] },
            { word: "طریقت", definition: "راه، راه خدا", example: "یکی از پیران طریقت گفت: الهی به نشان تو بینندگانیم.", tldr: "راه-عرفان", tip: "پیروان یک 'طریق' یا روش عرفانی.", brainrot: "طریقت ما اینه که تا آخر می‌جنگیم.", distractors: ["گیسوی خوشبو", "پاسبان", "شب‌گرد"] },
            { word: "زنجیر معنبر", definition: "گیسوی عطر آگین", example: "زنجیر معنبر تو دام دل ماست.", tldr: "گیسوی-خوشبو", tip: "'معنبر' یعنی خوشبو شده با عطر عنبر.", brainrot: "این بازی با گرافیکش یه زنجیر معنبره که آدمو اسیر می‌کنه.", distractors: ["پاسبان", "شب‌گرد", "نشانه"] },
            { word: "شحنه", definition: "پاسبان", example: "روزها ایمنی از شحنه و شبها از عسس.", tldr: "نگهبان", tip: "مأمور حکومتی برای حفظ نظم شهر.", brainrot: "اینجا شحنه زیاد داره، باید با احتیاط حرکت کنیم.", distractors: ["گیسوی خوشبو", "شب‌گرد", "نشانه"] },
            { word: "عسس", definition: "شب گرد، پاسبان شب", example: "روزها ایمنی از شحنه و شبها از عسس.", tldr: "پاسبان-شب", tip: "نگهبانان شب.", brainrot: "باید مثل عسس‌ها تو شب حواسمون جمع باشه.", distractors: ["گیسوی خوشبو", "پاسبان", "نشانه"] }
        ]
    };

    // --- DOM ELEMENT REFERENCES ---
    const hubContainer = document.getElementById('hub-container');
    const quizViewContainer = document.getElementById('quiz-view-container');
    const goToQuizBtn = document.getElementById('go-to-quiz-btn');
    const backToHubBtn = document.getElementById('back-to-hub-btn');

    // Hub elements
    const searchInput = document.getElementById('search-input');
    const sourceSelect = document.getElementById('source-select');
    const wordContainer = document.getElementById('word-container');

    // Quiz elements
    const sourceSelectionContainer = document.getElementById('source-selection-container');
    const sourceButtonsContainer = document.getElementById('source-buttons');
    const modeSelectionContainer = document.getElementById('mode-selection-container');
    const backToSourcesBtn = document.getElementById('back-to-sources-btn');
    const normalModeBtn = document.getElementById('normal-mode-btn');
    const hardModeBtn = document.getElementById('hard-mode-btn');
    const restartBtn = document.getElementById('restart-btn');
    
    const allElements = {
        normal: {
            container: document.getElementById('quiz-container'),
            questionText: document.getElementById('question-text'),
            hintText: document.getElementById('hint-text'),
            answerContainer: document.getElementById('answer-buttons'),
            prevBtn: document.getElementById('prev-btn-normal'),
            nextBtn: document.getElementById('next-btn-normal'),
            counter: document.getElementById('question-counter-normal'),
            backToMenuBtn: document.getElementById('back-to-menu-btn-normal')
        },
        hard: {
            container: document.getElementById('hard-mode-container'),
            questionText: document.getElementById('hard-mode-question-text'),
            input: document.getElementById('hard-mode-input'),
            prevBtn: document.getElementById('prev-btn-hard'),
            nextBtn: document.getElementById('next-btn-hard'),
            counter: document.getElementById('hard-mode-question-counter'),
            backToMenuBtn: document.getElementById('back-to-menu-btn-hard')
        },
        results: {
            container: document.getElementById('results-container'),
            scoreText: document.getElementById('score-text'),
            reviewContainer: document.getElementById('results-review')
        }
    };

    // --- STATE VARIABLES ---
    let selectedSource = '';
    let currentMode = '';
    let currentSourceData = [];
    let currentQuestionIndex = 0;
    let userAnswers = [];

    // --- INITIALIZATION ---
    function init() {
        // Hub Initialization
        populateSourceSelector();
        displayWords();

        // Quiz Initialization
        populateQuizSourceButtons();
        
        // Event Listeners for View Switching
        goToQuizBtn.addEventListener('click', showQuizView);
        backToHubBtn.addEventListener('click', showHubView);

        // Hub Listeners
        sourceSelect.addEventListener('change', () => displayWords(sourceSelect.value, searchInput.value));
        searchInput.addEventListener('input', () => displayWords(sourceSelect.value, searchInput.value));
        
        // Quiz Listeners
        backToSourcesBtn.addEventListener('click', () => showQuizScreen(sourceSelectionContainer));
        normalModeBtn.addEventListener('click', () => startQuiz('normal'));
        hardModeBtn.addEventListener('click', () => startQuiz('hard'));
        restartBtn.addEventListener('click', () => showQuizScreen(sourceSelectionContainer));

        allElements.normal.prevBtn.addEventListener('click', () => navigate(-1));
        allElements.normal.nextBtn.addEventListener('click', handleNextClick);
        allElements.normal.backToMenuBtn.addEventListener('click', () => showQuizScreen(sourceSelectionContainer));
        
        allElements.hard.prevBtn.addEventListener('click', () => navigate(-1));
        allElements.hard.nextBtn.addEventListener('click', handleNextClick);
        allElements.hard.backToMenuBtn.addEventListener('click', () => showQuizScreen(sourceSelectionContainer));
        allElements.hard.input.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                handleNextClick();
            }
        });
    }

    function handleNextClick() {
        if (currentQuestionIndex === currentSourceData.length - 1) {
            submitQuiz();
        } else {
            navigate(1);
        }
    }

    // --- VIEW MANAGEMENT ---
    function showHubView() {
        quizViewContainer.classList.add('hidden');
        hubContainer.classList.remove('hidden');
    }

    function showQuizView() {
        hubContainer.classList.add('hidden');
        quizViewContainer.classList.remove('hidden');
        showQuizScreen(sourceSelectionContainer);
    }

    // --- HUB FUNCTIONS ---
    function createWordCard(wordData) {
        const card = document.createElement('div');
        card.className = 'bg-white rounded-xl shadow-md p-6 flex flex-col';
        card.innerHTML = `
            <h3 class="text-2xl font-bold text-slate-800">${wordData.word}</h3>
            <p class="text-slate-500 font-medium">${wordData.pronunciation || ''}</p>
            <hr class="my-4">
            <div class="space-y-3 text-right">
                <p><strong class="text-blue-600">معنی:</strong> ${wordData.definition}</p>
                <p><strong class="text-blue-600">مثال:</strong> <em class="text-slate-700">"${wordData.example}"</em></p>
                <p><strong class="text-blue-600">خلاصه:</strong> <span class="font-semibold bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${wordData.tldr}</span></p>
                <p><strong class="text-blue-600">نکته:</strong> ${wordData.tip}</p>
                <p><strong class="text-blue-600">توضیح خودمونی:</strong> ${wordData.brainrot}</p>
            </div>
        `;
        return card;
    }

    function displayWords(filter = 'all', searchTerm = '') {
        wordContainer.innerHTML = '';
        let wordsToDisplay = [];

        if (filter === 'all') {
            Object.values(vocabularyData).forEach(source => {
                wordsToDisplay.push(...source);
            });
        } else {
            wordsToDisplay = vocabularyData[filter] || [];
        }

        if (searchTerm) {
            wordsToDisplay = wordsToDisplay.filter(wordData => 
                wordData.word.includes(searchTerm)
            );
        }

        if (wordsToDisplay.length === 0) {
            wordContainer.innerHTML = `<p class="text-slate-500 text-center col-span-full">واژه‌ای یافت نشد.</p>`;
            return;
        }

        wordsToDisplay.forEach(wordData => {
            const card = createWordCard(wordData);
            wordContainer.appendChild(card);
        });
    }

    function populateSourceSelector() {
        Object.keys(vocabularyData).forEach(sourceName => {
            const option = document.createElement('option');
            option.value = sourceName;
            option.textContent = sourceName;
            sourceSelect.appendChild(option);
        });
    }

    // --- QUIZ FUNCTIONS ---
    function populateQuizSourceButtons() {
        Object.keys(vocabularyData).forEach(sourceName => {
            if (vocabularyData[sourceName] && vocabularyData[sourceName].length > 0) {
                const button = document.createElement('button');
                button.innerText = sourceName;
                button.className = 'bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors';
                button.addEventListener('click', () => selectSource(sourceName));
                sourceButtonsContainer.appendChild(button);
            }
        });
    }

    function showQuizScreen(screen) {
        sourceSelectionContainer.classList.add('hidden');
        modeSelectionContainer.classList.add('hidden');
        allElements.normal.container.classList.add('hidden');
        allElements.hard.container.classList.add('hidden');
        allElements.results.container.classList.add('hidden');
        if (screen) screen.classList.remove('hidden');
    }

    function selectSource(sourceName) {
        selectedSource = sourceName;
        showQuizScreen(modeSelectionContainer);
    }
    
    function startQuiz(mode) {
        currentMode = mode;
        currentSourceData = shuffleArray([...vocabularyData[selectedSource]]);
        currentQuestionIndex = 0;
        userAnswers = new Array(currentSourceData.length).fill(null);
        
        showQuizScreen(allElements[mode].container);
        displayCurrentQuestion();
    }

    function displayCurrentQuestion() {
        if (currentMode === 'normal') {
            displayNormalQuestion();
        } else {
            displayHardQuestion();
        }
        updateNavButtons();
    }

    function navigate(direction) {
        saveCurrentAnswer();
        currentQuestionIndex += direction;
        displayCurrentQuestion();
    }
    
    function saveCurrentAnswer() {
        if (currentMode === 'normal') {
            const selectedButton = allElements.normal.answerContainer.querySelector('.selected');
            userAnswers[currentQuestionIndex] = selectedButton ? selectedButton.innerText : null;
        } else {
            userAnswers[currentQuestionIndex] = allElements.hard.input.value;
        }
    }
    
    function submitQuiz() {
        saveCurrentAnswer();
        let score = 0;
        
        currentSourceData.forEach((question, index) => {
            const userAnswer = userAnswers[index];
            let isCorrect = false;

            if (userAnswer) {
                if (currentMode === 'normal') {
                    isCorrect = userAnswer === question.definition;
                } else { 
                    const similarity = calculateSimilarity(userAnswer, question.definition);
                    isCorrect = similarity >= 0.75;
                }
            }
            if (isCorrect) score++;
        });
        
        showResults(score);
    }

    function displayNormalQuestion() {
        const ui = allElements.normal;
        const question = currentSourceData[currentQuestionIndex];
        
        ui.questionText.innerText = `معنی واژه «${question.word}» چیست؟`;
        ui.hintText.innerText = `راهنمایی: ${question.tip}`;
        ui.counter.innerText = `${currentQuestionIndex + 1} / ${currentSourceData.length}`;
        
        while (ui.answerContainer.firstChild) {
            ui.answerContainer.removeChild(ui.answerContainer.firstChild);
        }

        const answers = shuffleArray([
            question.definition,
            ...question.distractors
        ]);

        answers.forEach(answerText => {
            const button = document.createElement('button');
            button.innerText = answerText;
            button.className = 'answer-btn w-full bg-slate-100 border-2 border-slate-300 rounded-lg p-4 text-right font-medium hover:bg-slate-200 hover:border-blue-500 transition-colors';
            
            if (answerText === userAnswers[currentQuestionIndex]) {
                button.classList.add('selected');
            }

            button.addEventListener('click', (e) => {
                Array.from(ui.answerContainer.children).forEach(btn => btn.classList.remove('selected'));
                e.target.classList.add('selected');
            });
            ui.answerContainer.appendChild(button);
        });
    }

    function displayHardQuestion() {
        const ui = allElements.hard;
        const question = currentSourceData[currentQuestionIndex];

        ui.questionText.innerText = `معنی واژه «${question.word}» چیست؟`;
        ui.counter.innerText = `${currentQuestionIndex + 1} / ${currentSourceData.length}`;
        ui.input.value = userAnswers[currentQuestionIndex] || '';
        ui.input.focus();
    }

    function updateNavButtons() {
        const ui = allElements[currentMode];
        ui.prevBtn.disabled = currentQuestionIndex === 0;
        ui.prevBtn.classList.toggle('opacity-50', ui.prevBtn.disabled);
        
        if (currentQuestionIndex === currentSourceData.length - 1) {
            ui.nextBtn.innerText = 'ارسال آزمون';
        } else {
            ui.nextBtn.innerText = 'بعدی';
        }
    }

    function showResults(score) {
        const ui = allElements.results;
        showQuizScreen(ui.container);
        ui.scoreText.innerText = `امتیاز نهایی شما: ${score} از ${currentSourceData.length}`;
        
        while (ui.reviewContainer.firstChild) {
            ui.reviewContainer.removeChild(ui.reviewContainer.firstChild);
        }

        currentSourceData.forEach((question, index) => {
            const userAnswer = userAnswers[index];
            let isCorrect;
            if (currentMode === 'normal') {
                isCorrect = userAnswer === question.definition;
            } else {
                isCorrect = userAnswer ? calculateSimilarity(userAnswer, question.definition) >= 0.75 : false;
            }

            const reviewItem = document.createElement('div');
            reviewItem.className = `review-item p-4 border-r-4 rounded-l-md ${isCorrect ? 'correct' : 'incorrect'}`;
            
            let answerHtml = '';
            if (isCorrect) {
                answerHtml = `<p class="text-sm">پاسخ شما: <span class="font-medium text-slate-700">"${userAnswer}"</span></p>`;
            } else {
                answerHtml = `
                    <p class="text-sm">پاسخ شما: <span class="font-medium text-red-700">"${userAnswer || 'پاسخ نداده'}"</span></p>
                    <p class="text-sm mt-1">پاسخ صحیح: <span class="font-medium text-green-700">"${question.definition}"</span></p>
                `;
            }

            reviewItem.innerHTML = `
                <div class="flex justify-between items-center">
                    <p class="font-bold text-slate-800">${index + 1}. ${question.word}</p>
                    <span class="text-2xl">${isCorrect ? '✅' : '❌'}</span>
                </div>
                <div class="mt-2 pr-2">
                    ${answerHtml}
                </div>
            `;
            ui.reviewContainer.appendChild(reviewItem);
        });
    }

    function tokenize(text) {
        // Simple tokenizer for Persian, removing common words and punctuation
        const stopWords = new Set(['از', 'به', 'در', 'و', 'که', 'این', 'آن', 'با', 'برای', 'تا', 'را']);
        return text.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").split(/\s+/).filter(word => word && !stopWords.has(word));
    }

    function calculateSimilarity(s1, s2) {
        const tokens1 = tokenize(s1);
        const tokens2 = tokenize(s2);

        if (tokens1.length === 0 || tokens2.length === 0) {
            return (s1.trim() === s2.trim()) ? 1 : 0;
        }

        let matches = tokens1.filter(token => tokens2.includes(token)).length;
        
        const totalUniqueTokens = new Set([...tokens1, ...tokens2]).size;
        if (totalUniqueTokens === 0) return 1;
        return matches / totalUniqueTokens;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    init();
</script>
</body>
</html>
